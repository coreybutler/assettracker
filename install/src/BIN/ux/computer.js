computer=function(y){var f=new Ext.data.SimpleStore({fields:["id","dt","usr","act","ctg"],data:[]});var q=new Ext.data.Record.create([{name:"id",mapping:"id"},{name:"dt",mapping:"dt"},{name:"usr",mapping:"usr"},{name:"act",mapping:"act"},{name:"ctg",mapping:"ctg"}]);var d=new Ext.data.SimpleStore({fields:["ctg"],data:[]});
var o=new Ext.data.SimpleStore({fields:["ctg"],data:[]});var m=new Ext.data.Record.create([{name:"ctg",mapping:"ctg"}]);var p=new Ext.data.SimpleStore({fields:["appid","app","ctg"],data:[]});var z=new Ext.data.Record.create([{name:"appid",mapping:"appid"},{name:"app",mapping:"app"},{name:"ctg",mapping:"ctg"}]);
var k={};Ext.override(Ext.grid.PropertyGrid,{getName:function(w){var A=this.propStore.store.getAt(w);return A.get("name");},removeProperty:function(A){delete this.propStore.source[A];var w=this.propStore.store.getById(A);this.propStore.store.remove(w);}});var g=new Ext.LoadMask(Ext.getBody(),{msg:rb.defaults.savemessage});
var n=new Ext.LoadMask(Ext.getBody(),{msg:rb.defaults.loadmessage});var h=new Ext.Panel({layout:"border",border:false,defaults:{split:true},items:[{region:"center",layout:"border",border:false,defaults:{split:true},items:[{region:"center",layout:"border",border:false,defaults:{split:true},items:[new Ext.grid.GridPanel({region:"center",closable:false,store:p,colModel:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:rb.appTitle,dataIndex:"app"},{header:rb.appCategory,dataIndex:"ctg"}]}),viewConfig:{forceFit:true},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),listeners:{rowcontextmenu:function(C,A,D){var B=C.getStore().getAt(A);
var w=new Ext.menu.Menu({items:[{text:rb.removeMenu,iconCls:"icon-remove",handler:function(){Ext.Ajax.request({url:rb.data,params:{post:"removeapplication",id:B.data.appid},success:function(E,F){C.getStore().remove(B);}});}},"-",{text:rb.removeAndChangeMenu,iconCls:"icon-remove",handler:function(){Ext.Ajax.request({url:rb.data,params:{post:"removeapplication",id:B.data.appid,change:Ext.encode(B.data),sysid:h.ownerCt.id.replace(/tab\_/g,"")},success:function(E,H){var J=Ext.decode(E.responseText);
C.getStore().remove(B);f.insert(0,new q({id:J.id,dt:new Date(),usr:Ext.getUsername(),act:rb.appRmvChangeTpl+B.data.app+" ("+B.data.ctg+")",ctg:rb.appRmvDefaultCtg}));f.sort("dt","DESC");var G=u("changegrid");G.getSelectionModel().selectRow(G.getStore().find("id",J.id));G.getView().focusRow(G.getStore().find("id",J.id));
var I=h.items.get(1).items.get(1).items.get(0);var F=G.getStore().getAt(G.getStore().find("id",J.id));I.removeAll();I.add({html:a(F.data)});I.doLayout();I.getBottomToolbar().enable();}});}}]});w.showAt(D.getXY());}},bbar:new Ext.Toolbar({items:[{text:rb.appAddButton,iconCls:"icon-add",handler:function(){l.show();
}},"->",{text:rb.appRemoveInstruct,xtype:"tbtext"}]})}),new Ext.grid.PropertyGrid({region:"west",width:300,source:k,bbar:new Ext.Toolbar({hidden:false,items:[{text:rb.propertyButton,iconCls:"icon-add",handler:function(){var A=new Ext.Window({title:rb.propertyWindowTitle,width:450,height:185,layout:"fit",modal:true,items:[new Ext.form.FormPanel({border:false,bodyStyle:"padding:10px",defaults:{width:250,xtype:"textfield",allowBlank:false},monitorValid:true,items:[{fieldLabel:rb.propertyFieldName,name:"prop",maskRe:/[^#\'\&\=\>\<\\\,\;]/},{fieldLabel:rb.propertyFieldValue,name:"val"},{xtype:"checkbox",name:"check",checked:false,boxLabel:rb.propertyUseAll}],listeners:{clientvalidation:function(w,B){w.ownerCt.getBottomToolbar().items.get(w.ownerCt.getBottomToolbar().items.length-1).setDisabled(!B);
w.ownerCt.getBottomToolbar().items.get(w.ownerCt.getBottomToolbar().items.length-3).setDisabled(!B);}}})],bbar:new Ext.Toolbar({items:["->",{text:rb.propertyButtonSaveNew,disabled:true,iconCls:"icon-save",handler:function(){v(A.items.get(0).getForm());A.items.get(0).getForm().reset();}},"-",{text:rb.propertyButtonSaveClose,disabled:true,iconCls:"icon-save",handler:function(){v(A.items.get(0).getForm());
A.hide();A.items.get(0).getForm().reset();}}]})});A.show();}},"->",{xtype:"tbtext",text:rb.propertyButtonRemove}]}),listeners:{propertychange:function(C,w,B,A){Ext.Ajax.request({url:rb.data,params:{post:"editproperty",id:b(),prop:w,value:B},success:function(){}});},rowcontextmenu:function(C,B,D){var w=u("property").getName(B);
var A=new Ext.menu.Menu({items:[{text:rb.removeProperty+" "+w,iconCls:"icon-remove",handler:function(){Ext.Msg.show({title:rb.removeProperty+" "+w+"?",msg:rb.removePropertyWarning,buttons:Ext.Msg.YESNO,fn:function(E){if(E=="yes"){Ext.Ajax.request({url:rb.data,params:{post:"removeproperty",prop:w},success:function(F,J){u("property").removeProperty(w);
var H=h.ownerCt.ownerCt.items;for(var G=0;G<H.length;G++){if(H.get(G).id!=h.ownerCt.id&&H.get(G).id.substring(0,7)=="tab_CN="){var I=H.get(G).items.get(0).items.get(0).items.get(0).items.get(1);I.removeProperty(w);}}}});}},icon:Ext.MessageBox.WARNING});}}]});A.showAt(D.getXY());}}})]},{region:"south",title:rb.systemNoteTitle,height:300,autoScroll:true,layout:"fit",defaults:{border:false,layout:"fit",autoScroll:true,bodyStyle:"padding:10px;font-family:Arial;font-size:small;"},bbar:new Ext.Toolbar({items:["->",{text:rb.systemNoteEditButton,iconCls:"icon-edit",handler:function(){var w=new Ext.Window({title:rb.systemNoteTitle,boder:false,modal:true,width:600,height:400,layout:"fit",items:[new Ext.form.HtmlEditor({autoScroll:true,name:"note",value:this.ownerCt.ownerCt.items.get(0).initialConfig.html})],bbar:new Ext.Toolbar({items:["->",{text:rb.saveNoteButton,iconCls:"icon-save",handler:function(){var A=this.ownerCt.ownerCt.items.get(0).getValue();
A=Ext.cleanHTMLEditorContent(A);Ext.Ajax.request({url:rb.data,params:{post:"note",id:b(),note:Ext.encode(A)},success:function(B,C){var D=u("notes");D.removeAll();D.add({html:A,autoScroll:true});D.doLayout();w.close();}});}}]})});w.show();}}]})}]},{region:"east",width:425,layout:"border",border:false,defaults:{split:true},items:[new Ext.grid.GridPanel({region:"center",header:false,closable:false,store:f,colModel:new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:rb.change,dataIndex:"act"},{header:rb.changeCategory,dataIndex:"ctg",width:25},{header:rb.changeDate,dataIndex:"dt",width:40,xtype:"datecolumn",format:"m-d-Y"},{header:rb.changeUser,dataIndex:"usr",width:60,hidden:true}]}),viewConfig:{forceFit:true},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),listeners:{rowclick:function(A,w,B){var D=f.getAt(w).data;
var C=A.ownerCt.items.get(1).items.get(0);C.removeAll();C.add({html:a(D)});C.doLayout();C.getBottomToolbar().enable();},keypress:function(w){var B=this.getSelectionModel().getSelected().data;var A=this.ownerCt.items.get(1).items.get(0);A.removeAll();A.add({html:a(B)});A.doLayout();A.getBottomToolbar().enable();
}}}),{region:"south",layout:"border",border:false,height:430,defaults:{split:true},items:[{region:"center",layout:"fit",defaults:{bodyStyle:"padding:4px;font-family:Arial;font-size:x-small;color:#333;",border:false,header:false,layout:"fit",autoScroll:true},autScroll:true,bbar:new Ext.Toolbar({disabled:true,items:["->",{text:"Edit",iconCls:"icon-edit",handler:s},{text:"Delete",iconCls:"icon-remove",handler:r}]})},new Ext.form.FormPanel({height:300,title:rb.changeFormTitle,bodyStyle:"padding:10px;",region:"south",monitorValid:true,defaults:{width:260,xtype:"textfield"},items:[new Ext.form.ComboBox({fieldLabel:rb.changeFieldCategory,store:d,typeAhead:false,mode:"local",triggerAction:"all",emptyText:"Unknown...",selectOnFocus:true,allowBlank:false,forceSelection:false,displayField:"ctg",value:"Unknown",name:"ctg"}),new Ext.form.DateField({fieldLabel:rb.changeFieldDate,allowBlank:false,value:new Date(),name:"dt"}),{fieldLabel:rb.changeFieldUser,allowBlank:false,value:Ext.getUsername(),name:"usr"},{fieldLabel:rb.changeFieldAction,xtype:"textarea",height:135,allowBlank:false,name:"act"}],bbar:new Ext.Toolbar({items:["->",{text:rb.changeResetButton,iconCls:"icon-refresh",handler:function(){this.ownerCt.ownerCt.getForm().reset();
}},{text:rb.changeSaveNewButton,iconCls:"icon-save",disabled:true,handler:function(){var w=g;var B=h.items.get(1).items.get(0);var C=B.getStore();var D=this.ownerCt.ownerCt.getForm();var E=D.getFieldValues();var F=h.items.get(1).items.get(1).items.get(0);var A=E.dt;w.show();E.id=h.ownerCt.id.replace(/tab\_/g,"");
E.dt=E.dt.format("m-d-Y");Ext.Ajax.request({url:rb.data,params:{post:"newchange",data:Ext.encode(E)},success:function(G,H){var I=Ext.decode(G.responseText).id;C.insert(0,new q({id:I,dt:A,usr:E.usr,act:E.act,ctg:E.ctg}));B.getSelectionModel().selectFirstRow();F.removeAll();F.add({html:a(E)});F.doLayout();
F.getBottomToolbar().enable();D.reset();w.hide();}});}}]}),listeners:{clientvalidation:function(w,A){w.getBottomToolbar().items.get(w.getBottomToolbar().items.length-1).setDisabled(!A);}}})]}]}],tbar:new Ext.Toolbar({items:[{text:rb.rdp,iconCls:"icon-rdp",disabled:true,handler:function(){var w=h.ownerCt.data;
window.open(rb.rdpurl+w.dns);}},{text:rb.ssh,iconCls:"icon-ssh",disabled:true,handler:function(){var w=h.ownerCt.data;window.open(rb.sshurl+w.dns);}},"-",{text:rb.reportButton,iconCls:"icon-pdf",menu:new Ext.menu.Menu({items:[{text:rb.reportMenuAll,handler:function(){document.location=rb.reportUrl+b()+"&report=all&format=pdf";
}},{text:rb.reportMenuProp,handler:function(){document.location=rb.reportUrl+b()+"&report=properties&format=pdf";}},{text:rb.reportMenuHistory,handler:function(){document.location=rb.reportUrl+b()+"&report=history&format=pdf";}}]})}]})});var l=new Ext.Window({title:rb.appAddButton,height:165,width:400,layout:"fit",modal:true,closeAction:"hide",items:[new Ext.form.FormPanel({bodyStyle:"padding:10px",border:false,monitorValid:true,defaults:{xtype:"textfield",width:250},items:[{allowBlank:false,fieldLabel:rb.appFieldName,name:"nm"},new Ext.form.ComboBox({fieldLabel:rb.appFieldCategory,store:o,displayField:"ctg",typeAhead:true,mode:"local",triggerAction:"all",emptyText:rb.defaults.appCategory,selectOnFocus:true,allowBlank:false,name:"ctg"}),new Ext.form.Checkbox({boxLabel:rb.appAddToChanges,checked:false,name:"chglog"})],listeners:{clientvalidation:function(w,A){w.ownerCt.getBottomToolbar().items.get(1).setDisabled(!A);
}}})],bbar:new Ext.Toolbar({items:["->",{text:rb.appSaveButton,iconCls:"icon-save",disabled:true,handler:function(){var w=this.ownerCt.ownerCt.items.get(0).getForm().getFieldValues();w.id=h.ownerCt.id.replace(/tab\_/g,"");Ext.Ajax.request({url:rb.data,params:{post:"newapplication",data:Ext.encode(w)},success:function(A,F){var H=Ext.decode(A.responseText);
p.insert(0,new z({appid:H.id,app:w.nm,ctg:w.ctg}));var E=false;for(var B=0;B<d.getCount();B++){if(d.getAt(B).data.ctg.trim()==w.ctg.trim()){E=true;break;}}if(!E){d.add(new m({ctg:w.ctg.trim()}));d.sort("ctg");}if(H.chgid!=undefined){f.insert(0,new q({id:H.chgid,dt:new Date(),usr:Ext.getUsername(),act:rb.appAddChangeTpl+w.nm+" ("+w.ctg+")",ctg:rb.appAddDefaultCtg}));
f.sort("dt","DESC");var D=u("changegrid");D.getSelectionModel().selectRow(D.getStore().find("id",H.chgid));D.getView().focusRow(D.getStore().find("id",H.chgid));var G=h.items.get(1).items.get(1).items.get(0);var C=D.getStore().getAt(D.getStore().find("id",H.chgid));G.removeAll();G.add({html:a(C.data)});
G.doLayout();G.getBottomToolbar().enable();}l.hide();l.items.get(0).getForm().reset();if(!E){l.doLayout();}}});}}]})});Ext.apply(this,{layout:"fit",closable:true,border:false,plain:true,items:[h]});computer.superclass.constructor.apply(this,arguments);this.on("render",x,this);function x(){var w=n;w.show();
Ext.Ajax.request({url:rb.data,params:{get:"computer",id:this.id.replace(/tab\_/g,"")},success:function(M,H){var A=Ext.decode(M.responseText);var L=c(A.computer.CHANGES);var B=c(A.computer.PROPERTIES);var E=c(A.computer.PROPERTYLIST);var D=c(A.computer.APPLICATIONS);var F=c(A.computer.CATEGORIES);var J=A.computer.NOTES.trim();
var K=A.categories;if(h.ownerCt.initialConfig.iconCls.toLowerCase().indexOf("win")>=0){h.getTopToolbar().items.get(0).enable();}else{h.getTopToolbar().items.get(1).enable();}var C=u("notes");C.add({border:false,header:false,html:J,layout:"fit",autoScroll:true,bodyStyle:"padding:6px;font-family:Arial;font-size:small;"});
C.doLayout();for(var G=0;G<F.length;G++){o.add(new m({ctg:F[G].CTG}));}for(G=0;G<D.length;G++){p.add(new z({appid:D[G].APPID,app:D[G].APP,ctg:D[G].CTG}));}for(G=0;G<E.length;G++){k[E[G].PROP]="";}for(G=0;G<B.length;G++){k[B[G].PROP]=B[G].VAL;}u("property").setSource(k);for(G=0;G<L.length;G++){var I=L[G];
f.add(new q({id:I.CHGID,dt:I.CHGDT,usr:I.USR,act:I.ACT,ctg:I.CTG}));}for(G=0;G<A.categories.length;G++){d.add(new m({ctg:A.categories[G]}));}w.hide();}});}function e(){return this.username;}function v(w){var A=w.getFieldValues();var B=u("property");k[A.prop]=A.val;B.setSource(k);A.id=b();Ext.Ajax.request({url:rb.data,params:{post:"newproperty",data:Ext.encode(A),check:A.check},success:function(C,G){var E=h.ownerCt.ownerCt.items;
for(var D=0;D<E.length;D++){if(E.get(D).id!=h.ownerCt.id&&E.get(D).id.substring(0,7)=="tab_CN="){var F=E.get(D).items.get(0).items.get(0).items.get(0).items.get(1);var H=F.getSource();if(H[A.prop]==undefined){if(A.check){H[A.prop]=A.val;}else{H[A.prop]="";}}F.setSource(H);}}}});}function a(A){var w=new Date(A.dt).format("m-d-Y").toString();
return'<div style="width:33%;float:left;"><b>'+rb.changeTypeTitle.toUpperCase()+":</b> "+A.ctg+'</div><div style="width:33%;float:left;"><b>'+rb.changeUserTitle.toUpperCase()+":</b> "+A.usr+'</div><div style="width:33%;float:left;"><b>'+rb.changeDateTitle.toUpperCase()+":</b> "+w+'</div><div style="clear:both;height:3px;border-bottom:1px dotted #eee !important;margin-bottom:6px;width:100%;"></div>'+A.act;
}function r(){var A=h.items.get(1).items.get(0).getSelectionModel();var w=A.getSelected();var B=w.data;Ext.Msg.show({title:rb.changeRemoveTitle,msg:rb.changeRemoveText,buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(C){if(C=="yes"){Ext.Ajax.request({url:rb.data,params:{post:"removechange",id:B.id},success:function(D,E){var F=h.items.get(1).items.get(1).items.get(0);
F.removeAll();F.getBottomToolbar().disable();f.remove(w);}});}}});}function s(){var w=h.items.get(1).items.get(0).getSelectionModel().getSelected();var B=w.data;var A=new Ext.Window({iconCls:"icon-edit",title:rb.changeEditTitle,modal:true,height:300,width:450,closeAction:"close",layout:"fit",items:[new Ext.form.FormPanel({bodyStyle:"padding:10px;",border:false,defaults:{width:300,xtype:"textfield"},items:[new Ext.form.ComboBox({fieldLabel:rb.changeFieldCategory,store:d,typeAhead:false,mode:"local",triggerAction:"all",emptyText:"Unknown...",selectOnFocus:true,allowBlank:false,forceSelection:false,displayField:"ctg",value:B.ctg,name:"ctg"}),new Ext.form.DateField({fieldLabel:rb.changeFieldDate,allowBlank:false,value:new Date(B.dt),name:"dt"}),{fieldLabel:rb.changeFieldUser,allowBlank:false,value:B.usr,name:"usr"},{fieldLabel:rb.changeFieldAction,xtype:"textarea",height:75,value:B.act,name:"act",allowBlank:false},new Ext.form.Hidden({name:"id",value:B.id})]})],bbar:new Ext.Toolbar({items:[{xtype:"tbtext",text:rb.changeWarning},"->",{text:"Save Changes",iconCls:"icon-save",handler:function(){var C=g;
var D=this.ownerCt.ownerCt.items.get(0).getForm().getFieldValues();D.dt=D.dt.format("m/d/Y");C.show();A.hide();Ext.Ajax.request({url:rb.data,params:{post:"editchange",data:Ext.encode(D)},success:function(E,G){var H=h.items.get(1).items.get(1).items.get(0);var F=f.getAt(f.find("id",B.id));H.removeAll();
H.add({html:a(D)});H.doLayout();F.set("ctg",D.ctg);F.set("act",D.act);F.set("dt",D.dt);F.set("usr",D.usr);A.close();C.hide();}});}}]})});A.show();}function u(w){if(w=="property"){return h.items.get(0).items.get(0).items.get(1);}if(w=="appgrid"){return h.items.get(0).items.get(0).items.get(0);}if(w=="notes"){return h.items.get(0).items.get(1);
}if(w=="changegrid"){return h.items.get(1).items.get(0);}}function b(){return h.ownerCt.id.replace(/tab\_/g,"");}function c(A){var w=new Array();for(var C=0;C<A.DATA.length;C++){var B={};for(i=0;i<A.COLUMNS.length;i++){B[A.COLUMNS[i]]=A.DATA[C][i];}w.push(B);}return w;}function j(w){var A="";for(var B=0;
B<w;B++){A+="&nbsp;";}return A;}function t(B,A){for(var w=0;w<B.length;w++){if(B[w]==A){return true;}}return false;}};Ext.extend(computer,Ext.Panel,{});